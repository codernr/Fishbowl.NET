@page "/"
@using Microsoft.Extensions.Logging
@using Fishbowl.Net.Client.Online.Components.States

@inject NavigationManager NavigationManager
@inject IStorageService StorageService
@inject IScreenService ScreenService
@inject ILoggerFactory LoggerFactory
@inject IStringLocalizer<Resources> StringLocalizer
@inject IClientState ClientState

<StateManager @ref="this.stateManager" TransitionStarted="@this.OnStateTransition">
    <ConnectionClosed ReloadRequested="this.Reload" />
    <Password OnCreateGame="this.CreateGame" OnJoinGame="this.JoinGame" />
    <PlayerCount OnPlayerCountSet="this.SetPlayerCount" />
    <TeamCount OnTeamCountSet="this.SetTeamCount" />
    <WordCount OnWordCountSet="this.SetWordCount" />
    <RoundTypes OnRoundTypesSet="this.SetRoundTypes" />
    <PlayerName OnPlayerNameSet="this.SetPlayerName" />
    <PlayerWords OnPlayerWordsSet="this.SubmitPlayerData" />
    <WaitingForPlayers />
    <TeamName OnTeamNameSet="this.SetTeamName" />
    <WaitingForTeamNames />
    <PeriodSetupPlay OnStarted="this.Connection.StartPeriod" />
    <PeriodSetupWatch />
    <PeriodPlay
        OnScoreAdded="this.AddScore"
        OnPeriodFinished="this.Connection.FinishPeriod"
        OnLastScoreRevoked="this.Connection.RevokeLastScore" />
    <PeriodWatch />
    <PeriodFinished Delay="@TimeSpan.FromSeconds(4)" />
    <RoundFinished Delay="@TimeSpan.FromSeconds(4)" />
    <GameFinished ReloadRequested="this.Reload" />
    <Info Delay="@TimeSpan.FromSeconds(2)" />
</StateManager>

<MudPopover
    Open="this.isPlayerCountPopoverVisible"
    AnchorOrigin="Origin.BottomCenter"
    TransformOrigin="Origin.BottomCenter"
    Class="pa-5"
    Paper="false">
    <MudPaper Class="mud-theme-primary pa-2" Elevation="8">
        <MudText>
            @(string.Format(
                L("Pages.Play.PlayerCount"),
                this.ClientState.TotalPlayerCount,
                this.ClientState.ConnectedPlayerCount,
                this.ClientState.SetupPlayerCount))
        </MudText>
    </MudPaper>
</MudPopover>

<ToastContainer @ref="this.toastContainer" />
